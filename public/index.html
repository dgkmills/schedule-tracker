<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dgkmills.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style for the calendar grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            text-align: center;
        }
        .calendar-day-col {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background-color: #f9fafb;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
         @media (max-width: 640px) {
            .calendar-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .iframe-container {
            position: relative;
            padding-bottom: 100%; /* 1:1 aspect ratio */
            height: 0;
            overflow: hidden;
            width: 100%;
        }
        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <nav class="bg-white shadow-md rounded-b-xl fixed top-0 left-0 w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex-shrink-0">
                    <span class="text-2xl font-bold text-blue-600">schedule.dgkmills.com</span>
                </div>
                <div>
                </div>
                <!-- Updated desktop navigation with data attributes -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="#" data-page="home" class="nav-link border-b-2 border-transparent hover:border-blue-500 py-2 px-3 text-sm font-medium transition-colors">Home</a>
                    <a href="#" data-page="classes-projects" class="nav-link border-b-2 border-transparent hover:border-blue-500 py-2 px-3 text-sm font-medium transition-colors">About</a>
                    <a href="#" data-page="tools-for-learning" class="nav-link border-b-2 border-transparent hover:border-blue-500 py-2 px-3 text-sm font-medium transition-colors">Tools for Learning</a>
                    <a href="#" data-page="schedule" class="nav-link border-b-2 border-transparent hover:border-blue-500 py-2 px-3 text-sm font-medium transition-colors">Schedule</a>
                    <a href="#contact" class="nav-link-scroll border-b-2 border-transparent hover:border-blue-500 py-2 px-3 text-sm font-medium transition-colors">Contact</a>
                </div>
                <div>
                </div>
                <div class="sm:hidden">
                    <button id="menu-button" class="text-gray-500 hover:text-gray-700 focus:outline-none focus:text-gray-700">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Updated mobile navigation with data attributes -->
            <div id="mobile-menu" class="sm:hidden hidden pb-4 space-y-2">
                <a href="#" data-page="home" class="nav-link block rounded-lg py-2 px-4 text-sm font-medium text-gray-700 hover:bg-gray-200">Home</a>
                <a href="#" data-page="classes-projects" class="nav-link block rounded-lg py-2 px-4 text-sm font-medium text-gray-700 hover:bg-gray-200">About</a>
                <a href="#" data-page="tools-for-learning" class="nav-link block rounded-lg py-2 px-4 text-sm font-medium text-gray-700 hover:bg-gray-200">Tools for Learning</a>
                <a href="#" data-page="schedule" class="nav-link block rounded-lg py-2 px-4 text-sm font-medium text-gray-700 hover:bg-gray-200">Schedule</a>
                <a href="#contact" class="nav-link-scroll block rounded-lg py-2 px-4 text-sm font-medium text-gray-700 hover:bg-gray-200">Contact</a>
            </div>
        </div>
    </nav>
    <main class="pt-24 pb-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- ... existing page sections ... -->
        <div id="home" class="page-section active">
            <div class="bg-white shadow-lg rounded-xl p-8 mb-8">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-4 text-center">Your Journey to Fluency Starts Here</h1>
                <p class="text-lg text-gray-600 mb-8 text-center max-w-3xl mx-auto">I'm dedicated to helping you or your child achieve language goals through personalized lessons and a supportive learning environment. Explore my classes below to find the perfect fit!</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-blue-50 rounded-lg p-6 shadow-md border border-blue-200">
                        <img src="https://placehold.co/400x250/3B82F6/ffffff?text=Biz+Kid%24" alt="Biz Kid$ Class" class="rounded-md mb-4 w-full h-48 object-cover">
                        <h2 class="text-2xl font-bold text-blue-800 mb-2">Biz Kid$</h2>
                        <p class="text-blue-700 mb-4">A fun and engaging way for kids to learn English through a business-themed game. This popular class has been running for over a year and builds confidence with practical vocabulary and communication skills.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <a href="#" onclick="showPage('classes-projects')" class="inline-block text-center py-3 px-4 border border-blue-600 rounded-md shadow-sm text-lg font-medium text-blue-600 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                Learn More
                            </a>
                            <a href="#" onclick="showPage('schedule', 'Biz Kid$')" class="inline-block text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                Sign Up
                            </a>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-6 shadow-md border border-green-200">
                        <img src="https://placehold.co/400x250/22C55E/ffffff?text=Web+Kid%24" alt="Web Kid$ Class" class="rounded-md mb-4 w-full h-48 object-cover">
                        <h2 class="text-2xl font-bold text-green-800 mb-2">Web Kid$</h2>
                        <p class="text-green-700 mb-4">A new and innovative class where students learn web development basics. They will use Gemini to assist with content creation and build their own online portfolio websites. A fantastic way to combine language skills with technical creativity.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <a href="#" onclick="showPage('classes-projects')" class="inline-block text-center py-3 px-4 border border-green-600 rounded-md shadow-sm text-lg font-medium text-green-600 bg-white hover:bg-green-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                                Learn More
                            </a>
                            <a href="#" onclick="showPage('schedule', 'Web Kid$')" class="inline-block text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                                Sign Up
                            </a>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-200 p-4 rounded-lg border border-gray-300">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Latest Notice</h2>
                    <p class="text-gray-700">New student slots are now open! Visit the Schedule page to request a time slot for a free consultation. I look forward to working with you!</p>
                </div>
                <div class="mt-8 pt-8 border-t border-gray-300">
                    <h2 class="text-3xl font-extrabold text-gray-900 mb-4 text-center">Professional English for Businesses</h2>
                    <p class="text-lg text-gray-600 mb-8 text-center max-w-3xl mx-auto">Elevate your team's communication skills with my business-focused English classes, trusted by companies like Kohsel from Denmark.</p>
                    <div class="bg-purple-50 rounded-lg p-6 shadow-md border border-purple-200 mx-auto max-w-xl">
                        <img src="https://placehold.co/400x250/8B5CF6/ffffff?text=Professional+English" alt="Professional English Class" class="rounded-md mb-4 w-full h-48 object-cover">
                        <h2 class="text-2xl font-bold text-purple-800 mb-2">Professional English</h2>
                        <p class="text-purple-700 mb-4">A tailored curriculum focused on the language of business, from emails and presentations to meetings and negotiations. My proven methods help teams gain confidence and clarity in professional settings.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <a href="#" onclick="showPage('classes-projects')" class="inline-block text-center py-3 px-4 border border-purple-600 rounded-md shadow-sm text-lg font-medium text-purple-600 bg-white hover:bg-purple-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors">
                                Learn More
                            </a>
                            <a href="#" onclick="showPage('schedule', 'Professional English')" class="inline-block text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors">
                                Sign Up
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="classes-projects" class="page-section">
            <div class="bg-white shadow-lg rounded-xl p-8">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Classes, Projects & About</h1>
                <div class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">About Teacher Dan</h2>
                    <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
                        <img src="https://placehold.co/200x200/4B5563/F3F4F6?text=Teacher+Dan" alt="Teacher Dan's Portrait" class="rounded-full shadow-md w-48 h-48 object-cover flex-shrink-0">
                        <div class="text-lg text-gray-600">
                            <p class="mb-4">I'm a dedicated and passionate ESL instructor with over 10 years of experience. My teaching philosophy is centered on creating a dynamic and engaging learning environment where students feel empowered to take risks and grow their language skills. I believe in a holistic approach that combines core language practice with creative, project-based learning.</p>
                            <p>My journey into web development and AI has given me a unique perspective on how to integrate modern tools into language education. I'm excited to share these skills with my students and help them not only master English but also build valuable skills for the future. When I'm not teaching, you can find me exploring new technologies or hiking with my dog.</p>
                        </div>
                    </div>
                </div>
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Detailed Class Descriptions</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-blue-50 rounded-lg p-6 shadow-md border border-blue-200">
                            <h3 class="text-xl font-bold text-blue-800 mb-2">Biz Kid$</h3>
                            <p class="text-blue-700 mb-4">Biz Kid$ is my flagship business-focused ESL class designed to make learning English both fun and practical. Students are immersed in a gamified learning environment where they start their own pretend businesses. They practice essential vocabulary, conversational English, and presentational skills through interactive activities like designing products, marketing, and managing finances. This class is perfect for young learners who want to build a strong foundation in English while developing an entrepreneurial mindset.</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-6 shadow-md border border-green-200">
                            <h3 class="text-xl font-bold text-green-800 mb-2">Web Kid$</h3>
                            <p class="text-green-700 mb-4">Web Kid$ is an innovative new course where students combine their English language skills with modern web development. Using platforms like Gemini, they will learn the basics of HTML, CSS, and JavaScript to build their own personal websites. The class focuses on content creation, where students write descriptions, stories, or blog posts in English for their site. The final result is a professional online portfolio that showcases both their language proficiency and their technical creativity. This course is ideal for students who love technology and want to build a real-world project.</p>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-6 shadow-md border border-purple-200">
                            <h3 class="text-xl font-bold text-purple-800 mb-2">Professional English</h3>
                            <p class="text-purple-700 mb-4">My Professional English curriculum is designed for businesses and adults seeking to improve their communication in the workplace. With a focus on practical skills like writing effective emails, leading successful meetings, and delivering confident presentations, this course is tailored to your company's specific needs. I've successfully delivered this curriculum to international clients like Kohsel, and it's a proven method for enhancing team productivity and global collaboration.</p>
                        </div>
                    </div>
                </div>
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Student Projects</h2>
                    <p class="text-lg text-gray-600 mb-8">I'm incredibly proud of my students' work. Here are some of their websites, created to apply skills in a real-world, creative way.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <a href="https://dgkmills.github.io/Aree/" target="_blank" class="block bg-gray-50 rounded-lg p-6 shadow-md border border-gray-200 hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300">
                            <img src="https://placehold.co/400x250/2563EB/ffffff?text=Aree's+Portfolio" alt="Aree's Portfolio" class="rounded-md mb-4 w-full h-48 object-cover">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Aree's Website</h3>
                            <p class="text-gray-600">A personal website showcasing Aree's new skills and interests.</p>
                        </a>
                        <div class="bg-gray-50 rounded-lg p-6 shadow-md border border-gray-200">
                            <img src="https://placehold.co/400x250/D1D5DB/9CA3AF?text=Project+3" alt="Student Project 3" class="rounded-md mb-4 w-full h-48 object-cover">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Travel Photo Gallery</h3>
                            <p class="text-gray-600">A beautiful photo gallery showcasing new vocabulary and descriptive language.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="schedule" class="page-section">
            <div class="bg-white shadow-lg rounded-xl p-8">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Schedule a Consultation</h1>
                <p class="text-lg text-gray-600 mb-8">Ready to start your language journey? First, select a class you're interested in, then choose a time slot below to request a free 15-minute consultation.</p>
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8 hidden">
                    <p class="text-sm text-blue-700">Your unique user ID is <span id="userIdDisplay" class="font-mono bg-blue-100 p-1 rounded-md text-xs">Loading...</span></p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Select a Class</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button type="button" class="class-card p-4 border-2 border-gray-200 rounded-lg text-left hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" data-class="Biz Kid$">
                            <h3 class="font-semibold text-blue-800">Biz Kid$</h3>
                            <p class="text-sm text-gray-600">Business English for kids</p>
                        </button>
                        <button type="button" class="class-card p-4 border-2 border-gray-200 rounded-lg text-left hover:border-green-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors" data-class="Web Kid$">
                            <h3 class="font-semibold text-green-800">Web Kid$</h3>
                            <p class="text-sm text-gray-600">Web development + English</p>
                        </button>
                        <button type="button" class="class-card p-4 border-2 border-gray-200 rounded-lg text-left hover:border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors" data-class="Professional English">
                            <h3 class="font-semibold text-purple-800">Professional English</h3>
                            <p class="text-sm text-gray-600">Business communication</p>
                        </button>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Available Time Slots</h2>
                    <div class="calendar-grid text-sm font-medium text-gray-700" id="time-slots-container">
                        <!-- Day columns will be dynamically generated here -->
                    </div>
                </div>
                
                <form id="schedule-form" class="space-y-6">
                    <input type="hidden" id="selectedClass" name="selectedClass">
                    <div id="selected-class-display" class="bg-purple-100 p-3 rounded-md text-purple-800 text-center font-bold hidden">
                        Selected Class: <span id="selected-class"></span>
                    </div>
                    <div id="selected-time-display" class="bg-blue-100 p-3 rounded-md text-blue-800 text-center font-bold hidden">
                        Selected time slot: <span id="selected-time"></span>
                    </div>
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Your Name</label>
                        <input type="text" id="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border" required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Your Email</label>
                        <input type="email" id="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border" required>
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                        <textarea id="message" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"></textarea>
                    </div>
                    <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        <span id="submit-text">Submit Request</span>
                        <div id="submit-spinner" class="hidden h-6 w-6 border-4 border-white border-solid rounded-full loader ml-2"></div>
                    </button>
                    <div id="form-status" class="mt-4 text-center text-sm font-semibold"></div>
                </form>

                <!-- Class Tracker content moved here -->
                <div id="class-tracker" class="mt-8 pt-8 border-t border-gray-300">
                    <div class="bg-white shadow-lg rounded-xl p-8">
                        <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Class Tracker</h1>
                        <p class="text-lg text-gray-600 mb-8">Enter the unique client ID provided by Teacher Dan to view your class package progress.</p>
                        <form id="tracker-form" class="space-y-4 max-w-lg mx-auto mb-8">
                            <div>
                                <label for="clientIdInput" class="block text-sm font-medium text-gray-700">Your Client ID</label>
                                <input type="text" id="clientIdInput" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border" required>
                            </div>
                            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                <span id="tracker-submit-text">Check Progress</span>
                                <div id="tracker-submit-spinner" class="hidden h-6 w-6 border-4 border-white border-solid rounded-full loader ml-2"></div>
                            </button>
                            <div id="tracker-status" class="mt-4 text-center text-sm font-semibold"></div>
                        </form>
                        <div id="tracker-results" class="hidden bg-gray-50 rounded-lg p-6 border border-gray-200">
                            <h2 class="text-2xl font-bold text-gray-900 mb-4" id="clientName"></h2>
                            <div class="space-y-4">
                                <div class="bg-blue-100 p-4 rounded-lg">
                                    <p class="font-medium text-blue-800">Package Details</p>
                                    <p class="text-sm text-blue-700 mt-1">Package Name: <span id="packageName"></span></p>
                                    <p class="text-sm text-blue-700">Total Classes: <span id="totalClasses"></span></p>
                                    <p class="text-sm text-blue-700">Classes Used: <span id="classesUsed"></span></p>
                                </div>
                                <div class="p-4 rounded-lg bg-green-100">
                                    <p class="font-medium text-green-800">Classes Remaining</p>
                                    <p class="text-3xl font-bold text-green-700 mt-2" id="classesRemaining"></p>
                                </div>
                                <div id="class-history-container" class="p-4 rounded-lg bg-gray-100">
                                     <p class="font-medium text-gray-800">Class History</p>
                                     <ul id="classHistoryList" class="text-sm text-gray-700 mt-2 list-disc list-inside space-y-1">
                                        <!-- History will be populated here -->
                                     </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End of Class Tracker content -->
            </div>
        </div>
        <div id="tools-for-learning" class="page-section">
            <div class="bg-white shadow-lg rounded-xl p-8">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Tools for Learning</h1>
                <p class="text-lg text-gray-600 mb-8">These tools demonstrate the type of projects students learn to build in my Web Kid$ class.</p>
                <div class="grid grid-cols-1 gap-8">
                    <div class="bg-gray-50 rounded-lg p-6 shadow-md border border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">TDantts Project: A Gemini-Powered Tool</h3>
                        <p class="text-gray-600 mb-4">A dynamic blog featuring recipes and travel stories, with a focus on clear and engaging writing powered by Gemini.</p>
                        <div class="iframe-container">
                            <iframe src="https://tdantts.netlify.app" title="TDantts Gemini Blog" allow="microphone"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer id="contact" class="bg-white mt-8 py-8 px-4 sm:px-6 lg:px-8 shadow-inner rounded-t-xl">
        <div class="max-w-7xl mx-auto text-center text-gray-600">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Contact Information</h2>
            <p><strong>Email:</strong> <a href="mailto:dan@dgkmills.com" class="text-blue-600 hover:underline">dan@dgkmills.com</a></p>
            <p><strong>Phone:</strong> 086 333 1493</p>
            <p><strong>Location:</strong> Ban Pong, Thailand</p>
            <p class="mt-6 text-sm text-gray-500">&copy; 2025 Dgkmills.com. All rights reserved.</p>
        </div>
    </footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, getDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAdkkonrM6gFCN_xmw5g1qSJipHJ_LZKTE",
          authDomain: "schedule.dgkmills.com",
          projectId: "dgkmills-schedule-tracker",
          storageBucket: "dgkmills-schedule-tracker.appspot.com",
          messagingSenderId: "1078055932000",
          appId: "1:1078055932000:web:cba2d49fb42eaf319fb305",
          measurementId: "G-QJ1JM61WK3"
        };
        const app = initializeApp(firebaseConfig);
        
        const appCheck = initializeAppCheck(app, {
          provider: new ReCaptchaV3Provider('6Le_fssrAAAAAE79h4IgwgqxOghcpWqZyj95pTRq'),
          isTokenAutoRefreshEnabled: true
        });

        const db = getFirestore(app);
        const auth = getAuth(app);
        
        setLogLevel('debug');

        let userId = null;
        let authReady = false;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
            } else {
                userId = null; 
            }
            authReady = true;
            document.getElementById('userIdDisplay').textContent = userId || 'Unknown';
            initializeSchedule();
        });

        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch((error) => {
                console.error("Custom token sign-in failed:", error);
                signInAnonymously(auth).catch(e => console.error("Anonymous sign-in fallback failed:", e));
            });
        } else {
            signInAnonymously(auth).catch(e => console.error("Anonymous sign-in failed:", e));
        }
        
        let selectedTimeSlotId = null;
        let selectedClassValue = null;

        document.querySelectorAll('.class-card').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.class-card').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'ring-2', 'ring-offset-2', 'border-green-500', 'border-purple-500', 'ring-green-500', 'ring-purple-500');
                });
                const classValue = button.getAttribute('data-class');
                selectedClassValue = classValue;
                let ringColor = '';
                if (classValue === 'Biz Kid$') {
                    ringColor = 'ring-blue-500';
                } else if (classValue === 'Web Kid$') {
                    ringColor = 'ring-green-500';
                } else if (classValue === 'Professional English') {
                    ringColor = 'ring-purple-500';
                }
                button.classList.add('border-blue-500', 'ring-2', 'ring-offset-2', ringColor);
                document.getElementById('selectedClass').value = selectedClassValue;
                document.getElementById('selected-class').textContent = selectedClassValue;
                document.getElementById('selected-class-display').classList.remove('hidden');
            });
        });

        document.addEventListener('click', (e) => {
            if (e.target.matches('.time-slot-btn')) {
                const button = e.target;
                if (button.disabled) return;
                document.querySelectorAll('.time-slot-btn').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'ring-2', 'ring-offset-2');
                });
                button.classList.add('border-blue-500', 'ring-2', 'ring-offset-2');
                selectedTimeSlotId = button.getAttribute('data-slot-id');
                const day = button.getAttribute('data-day');
                const time = button.getAttribute('data-time');
                document.getElementById('selected-time').textContent = `${day}, ${time}`;
                document.getElementById('selected-time-display').classList.remove('hidden');
            }
        });
        
        function initializeSchedule() {
            if (!authReady) {
                 setTimeout(initializeSchedule, 100);
                 return;
            }
            if (!userId) {
                console.error('User not authenticated, cannot initialize schedule listeners.');
                const timeSlotsContainer = document.getElementById('time-slots-container');
                timeSlotsContainer.innerHTML = `<p class="text-center col-span-7 italic text-gray-500">Unable to load time slots. Please try refreshing the page.</p>`;
                return;
            }

            const appId = 'dgkmills-schedule-tracker';
            const timeSlotsCol = collection(db, `artifacts/${appId}/public/data/time-slots`);
            onSnapshot(timeSlotsCol, (querySnapshot) => {
                const timeSlotsContainer = document.getElementById('time-slots-container');
                timeSlotsContainer.innerHTML = ''; 

                if (querySnapshot.empty) {
                    timeSlotsContainer.innerHTML = `<p class="text-center col-span-7 italic text-gray-500">No time slots are currently available. Please check back later.</p>`;
                    return;
                }
                
                const slotsByDay = {};
                querySnapshot.forEach(doc => {
                    const data = { id: doc.id, ...doc.data() };
                    if (!slotsByDay[data.day]) {
                        slotsByDay[data.day] = [];
                    }
                    slotsByDay[data.day].push(data);
                });

                const dayOrder = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
                
                dayOrder.forEach(day => {
                    const dayCol = document.createElement('div');
                    dayCol.className = 'calendar-day-col';

                    const header = document.createElement('div');
                    header.className = 'bg-gray-200 p-2 rounded-md font-bold text-center';
                    header.textContent = day.substring(0, 3);
                    dayCol.appendChild(header);

                    if (slotsByDay[day]) {
                        slotsByDay[day].sort((a, b) => {
                            const timeA = new Date(`1970/01/01 ${a.time}`);
                            const timeB = new Date(`1970/01/01 ${b.time}`);
                            return timeA - timeB;
                        });
                        
                        slotsByDay[day].forEach(data => {
                            const button = document.createElement('button');
                            button.setAttribute('type', 'button');
                            button.setAttribute('data-slot-id', data.id);
                            button.setAttribute('data-day', data.day);
                            button.setAttribute('data-time', data.time);
                            
                            if (data.booked) {
                                button.disabled = true;
                                button.className = 'time-slot-btn p-2 rounded-md transition-colors font-medium bg-red-200 text-red-800 cursor-not-allowed';
                                button.textContent = `${data.time}`;
                            } else {
                                button.disabled = false;
                                button.className = 'time-slot-btn p-2 rounded-md transition-colors font-medium bg-green-200 text-green-800 hover:bg-green-300';
                                button.textContent = data.time;
                            }
                            dayCol.appendChild(button);
                        });
                    }
                    timeSlotsContainer.appendChild(dayCol);
                });
            });
        }
        
        const scheduleForm = document.getElementById('schedule-form');
        const submitBtn = scheduleForm.querySelector('button[type="submit"]');
        const submitText = document.getElementById('submit-text');
        const submitSpinner = document.getElementById('submit-spinner');
        const formStatus = document.getElementById('form-status');

        scheduleForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!selectedClassValue || !selectedTimeSlotId) {
                formStatus.textContent = 'Please select both a class and a time slot.';
                formStatus.classList.remove('text-green-600', 'text-red-600');
                formStatus.classList.add('text-yellow-600');
                return;
            }

            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');
            formStatus.textContent = '';

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;
            const appId = 'dgkmills-schedule-tracker';

            try {
                const timeSlotRef = doc(db, `artifacts/${appId}/public/data/time-slots`, selectedTimeSlotId);
                const timeSlotDoc = await getDoc(timeSlotRef);
                if (timeSlotDoc.exists() && timeSlotDoc.data().booked) {
                    formStatus.textContent = 'This time slot was just booked. Please select another one.';
                    formStatus.classList.remove('text-green-600', 'text-yellow-600');
                    formStatus.classList.add('text-red-600');
                    return;
                }
                
                await updateDoc(timeSlotRef, { booked: true });

                await addDoc(collection(db, `artifacts/${appId}/public/data/consultations`), {
                    class: selectedClassValue,
                    timeSlotId: selectedTimeSlotId,
                    day: document.querySelector(`[data-slot-id="${selectedTimeSlotId}"]`).getAttribute('data-day'),
                    time: document.querySelector(`[data-slot-id="${selectedTimeSlotId}"]`).getAttribute('data-time'),
                    name,
                    email,
                    message,
                    userId: userId,
                    timestamp: new Date().toISOString(),
                });

                formStatus.textContent = 'Your consultation request has been submitted! I will get back to you shortly.';
                formStatus.classList.remove('text-red-600', 'text-yellow-600');
                formStatus.classList.add('text-green-600');
                scheduleForm.reset();
                document.getElementById('selected-class-display').classList.add('hidden');
                document.getElementById('selected-time-display').classList.add('hidden');
                selectedClassValue = null;
                selectedTimeSlotId = null;

            } catch (e) {
                console.error("Error adding document: ", e);
                formStatus.textContent = `There was an error submitting your request. Please try again. Error: ${e.message}`;
                formStatus.classList.remove('text-green-600', 'text-yellow-600');
                formStatus.classList.add('text-red-600');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });

        const trackerForm = document.getElementById('tracker-form');
        const trackerStatus = document.getElementById('tracker-status');
        const trackerResults = document.getElementById('tracker-results');

        trackerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const clientId = document.getElementById('clientIdInput').value.trim();
            const appId = 'dgkmills-schedule-tracker';

            const submitBtn = trackerForm.querySelector('button[type="submit"]');
            const submitText = document.getElementById('tracker-submit-text');
            const submitSpinner = document.getElementById('tracker-submit-spinner');

            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');
            trackerStatus.textContent = '';
            trackerResults.classList.add('hidden');

            if (!clientId) {
                trackerStatus.textContent = 'Please enter a valid client ID.';
                trackerStatus.classList.add('text-red-600');
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
                return;
            }

            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/client-packages`, clientId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const classesTaught = data.classesTaught || [];
                    document.getElementById('clientName').textContent = data.clientName;
                    document.getElementById('packageName').textContent = data.packageName;
                    document.getElementById('totalClasses').textContent = data.totalClasses;
                    document.getElementById('classesUsed').textContent = classesTaught.length;
                    document.getElementById('classesRemaining').textContent = data.totalClasses - classesTaught.length;
                    
                    const historyList = document.getElementById('classHistoryList');
                    historyList.innerHTML = ''; // Clear previous results
                    if(classesTaught.length > 0) {
                        classesTaught.forEach(timestamp => {
                            const li = document.createElement('li');
                            li.textContent = new Date(timestamp).toLocaleDateString(); // Format date
                            historyList.appendChild(li);
                        });
                    } else {
                        const li = document.createElement('li');
                        li.textContent = 'No classes recorded yet.';
                        li.className = 'italic text-gray-500';
                        historyList.appendChild(li);
                    }

                    trackerResults.classList.remove('hidden');
                    trackerStatus.textContent = '';
                } else {
                    trackerStatus.textContent = 'Client ID not found. Please check with Teacher Dan.';
                    trackerStatus.classList.add('text-red-600');
                }
            } catch (error) {
                console.error("Error fetching client data:", error);
                trackerStatus.textContent = `An error occurred: ${error.message}`;
                trackerStatus.classList.add('text-red-600');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });
    </script>
    <script>
        // --- Page Navigation Logic ---
        const menuBtn = document.getElementById('menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        function showPage(pageId, context = null) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            const pageSection = document.getElementById(pageId);
            if (pageSection) {
                pageSection.classList.add('active');
            }
            mobileMenu.classList.add('hidden');

            if (pageId === 'schedule' && context) {
                const classButton = document.querySelector(`.class-card[data-class="${context}"]`);
                if (classButton) {
                    classButton.click();
                }
            }
        }

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.getAttribute('data-page');
                showPage(pageId);
            });
        });
        
        document.querySelectorAll('.nav-link-scroll').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
                mobileMenu.classList.add('hidden');
            });
        });

        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        window.onload = () => {
            showPage('home');
        };
        window.showPage = showPage;
    </script>
</body>
</html>


